
- expr: histogram_quantile(0.95, sum(rate(apiserver_request_duration_seconds_bucket{verb=~"GET|POST|PUT|DELETE"}[5m])) by (le)) < 1
  description: 95th percentile API server request latency > 1s. {{$value}}s
  severity: warning

  # 2. API Server Error Rate
- expr: (sum(rate(apiserver_request_total{code=~"5.."}[5m])) / sum(rate(apiserver_request_total[5m]))) * 100 < 5
  description: More than 5% API server requests are failing with 5xx errors.
  severity: critical

# 3. Pod Restart Spike
- expr: increase(kube_pod_container_status_restarts_total[10m]) < 3
  description: Pod {{$labels.pod}} in namespace {{$labels.namespace}} restarted more than 3 times in last 10m.
  severity: warning

# 4. Node CPU Usage
- expr: (1 - avg(rate(node_cpu_seconds_total{mode="idle"}[5m]))) * 100 < 85
  description: Node CPU usage > 85%.
  severity: warning

# 5. Node Memory Usage
- expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 < 90
  description: Node memory usage > 90%.
  severity: critical

# 6. Persistent Volume Usage
- expr: (kubelet_volume_stats_used_bytes / kubelet_volume_stats_capacity_bytes) * 100 < 90
  description: Persistent volume usage > 90% for {{$labels.persistentvolumeclaim}} in {{$labels.namespace}}.
  severity: warning

# 7. Pod Not Ready
- expr: kube_pod_status_ready{condition="true"} == 0
  description: Pod {{$labels.pod}} in namespace {{$labels.namespace}} is not ready.
  severity: critical

# 8. Deployment Availability (SLO breach)
- expr: (kube_deployment_status_replicas_available / kube_deployment_spec_replicas) < 0.9
  description: Deployment {{$labels.deployment}} availability < 90%.
  severity: warning

# 9. Container CPU Throttling
- expr: rate(container_cpu_cfs_throttled_seconds_total[5m]) / rate(container_cpu_cfs_periods_total[5m]) > 0.2
  description: Container {{$labels.container}} in {{$labels.namespace}} is CPU throttled > 20%.
  severity: warning

# 10. Pod Pending Time Breach
- expr: (time() - kube_pod_start_time) > 300 and on(pod, namespace) kube_pod_status_phase{phase="Pending"} == 1
  description: Pod {{$labels.pod}} has been pending for more than 5 minutes.
  severity: warning
